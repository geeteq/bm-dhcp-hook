<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 14.1.2 (20260124.0452)
 -->
<!-- Title: bm_dhcp_tap Pages: 1 -->
<svg width="714pt" height="1241pt"
 viewBox="0.00 0.00 714.00 1241.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1236.84)">
<title>bm_dhcp_tap</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-1236.84 709.81,-1236.84 709.81,4 -4,4"/>
<text xml:space="preserve" text-anchor="middle" x="352.9" y="-1217.44" font-family="Helvetica,Arial,sans-serif" font-size="12.00">bm&#45;dhcp&#45;tap.py — DHCP ACK Sniffer</text>
<!-- svc -->
<g id="node1" class="node">
<title>svc</title>
<ellipse fill="#cce5ff" stroke="#2255aa" cx="561.43" cy="-1176" rx="144.38" ry="36.08"/>
<text xml:space="preserve" text-anchor="middle" x="561.43" y="-1183.38" font-family="Helvetica,Arial,sans-serif" font-size="10.00">systemd: bm&#45;dhcp&#45;tap.service</text>
<text xml:space="preserve" text-anchor="middle" x="561.43" y="-1172.13" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Loads /opt/bm&#45;dhcp&#45;tap/bm&#45;hook.env</text>
<text xml:space="preserve" text-anchor="middle" x="561.43" y="-1160.88" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Binds AF_PACKET raw socket on ens3</text>
</g>
<!-- recv -->
<g id="node2" class="node">
<title>recv</title>
<path fill="#f0f4f8" stroke="#446688" d="M626.4,-1098.92C626.4,-1098.92 496.47,-1098.92 496.47,-1098.92 490.47,-1098.92 484.47,-1092.92 484.47,-1086.92 484.47,-1086.92 484.47,-1071.14 484.47,-1071.14 484.47,-1065.14 490.47,-1059.14 496.47,-1059.14 496.47,-1059.14 626.4,-1059.14 626.4,-1059.14 632.4,-1059.14 638.4,-1065.14 638.4,-1071.14 638.4,-1071.14 638.4,-1086.92 638.4,-1086.92 638.4,-1092.92 632.4,-1098.92 626.4,-1098.92"/>
<text xml:space="preserve" text-anchor="middle" x="561.43" y="-1080.78" font-family="Helvetica,Arial,sans-serif" font-size="10.00">recvfrom()</text>
<text xml:space="preserve" text-anchor="middle" x="561.43" y="-1069.53" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Receive raw Ethernet frame</text>
</g>
<!-- svc&#45;&gt;recv -->
<g id="edge1" class="edge">
<title>svc&#45;&gt;recv</title>
<path fill="none" stroke="#555555" d="M561.43,-1139.64C561.43,-1129.35 561.43,-1118.26 561.43,-1108.46"/>
<polygon fill="#555555" stroke="#555555" points="564.23,-1108.68 561.43,-1100.68 558.63,-1108.68 564.23,-1108.68"/>
</g>
<!-- chk_eth -->
<g id="node3" class="node">
<title>chk_eth</title>
<path fill="#fff3cd" stroke="#856404" d="M463.04,-1014.35C463.04,-1014.35 366.39,-982.15 366.39,-982.15 360.69,-980.25 360.69,-976.46 366.39,-974.57 366.39,-974.57 463.04,-942.37 463.04,-942.37 468.74,-940.47 480.12,-940.47 485.82,-942.37 485.82,-942.37 582.47,-974.57 582.47,-974.57 588.17,-976.46 588.17,-980.25 582.47,-982.15 582.47,-982.15 485.82,-1014.35 485.82,-1014.35 480.12,-1016.24 468.74,-1016.24 463.04,-1014.35"/>
<text xml:space="preserve" text-anchor="middle" x="474.43" y="-980.11" font-family="Helvetica,Arial,sans-serif" font-size="10.00">EtherType = 0x0800</text>
<text xml:space="preserve" text-anchor="middle" x="474.43" y="-968.86" font-family="Helvetica,Arial,sans-serif" font-size="10.00">(IPv4)?</text>
</g>
<!-- recv&#45;&gt;chk_eth -->
<g id="edge2" class="edge">
<title>recv&#45;&gt;chk_eth</title>
<path fill="none" stroke="#555555" d="M544.66,-1059C534.05,-1046.97 519.98,-1031.01 507.22,-1016.54"/>
<polygon fill="#555555" stroke="#555555" points="509.47,-1014.87 502.08,-1010.72 505.27,-1018.57 509.47,-1014.87"/>
</g>
<!-- chk_ip -->
<g id="node4" class="node">
<title>chk_ip</title>
<path fill="#fff3cd" stroke="#856404" d="M419.48,-883.92C419.48,-883.92 352.7,-853.96 352.7,-853.96 347.22,-851.5 347.22,-846.59 352.7,-844.14 352.7,-844.14 419.48,-814.18 419.48,-814.18 424.96,-811.72 435.9,-811.72 441.38,-814.18 441.38,-814.18 508.16,-844.14 508.16,-844.14 513.64,-846.59 513.64,-851.5 508.16,-853.96 508.16,-853.96 441.38,-883.92 441.38,-883.92 435.9,-886.37 424.96,-886.37 419.48,-883.92"/>
<text xml:space="preserve" text-anchor="middle" x="430.43" y="-850.8" font-family="Helvetica,Arial,sans-serif" font-size="10.00">IP proto = 17</text>
<text xml:space="preserve" text-anchor="middle" x="430.43" y="-839.55" font-family="Helvetica,Arial,sans-serif" font-size="10.00">(UDP)?</text>
</g>
<!-- chk_eth&#45;&gt;chk_ip -->
<g id="edge4" class="edge">
<title>chk_eth&#45;&gt;chk_ip</title>
<path fill="none" stroke="#555555" d="M462.29,-942.23C456.97,-926.83 450.67,-908.62 445.09,-892.47"/>
<polygon fill="#555555" stroke="#555555" points="447.83,-891.82 442.57,-885.17 442.54,-893.65 447.83,-891.82"/>
<text xml:space="preserve" text-anchor="middle" x="460.87" y="-910.03" font-family="Helvetica,Arial,sans-serif" font-size="9.00">yes</text>
</g>
<!-- discard -->
<g id="node11" class="node">
<title>discard</title>
<ellipse fill="#eeeeee" stroke="#888888" cx="391.43" cy="-208.89" rx="69.07" ry="28.13"/>
<text xml:space="preserve" text-anchor="middle" x="391.43" y="-210.64" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Discard frame</text>
<text xml:space="preserve" text-anchor="middle" x="391.43" y="-199.39" font-family="Helvetica,Arial,sans-serif" font-size="10.00">(next recvfrom)</text>
</g>
<!-- chk_eth&#45;&gt;discard -->
<g id="edge3" class="edge">
<title>chk_eth&#45;&gt;discard</title>
<path fill="none" stroke="#888888" d="M512.52,-950.94C540.78,-927.94 574.43,-891.79 574.43,-850.05 574.43,-850.05 574.43,-850.05 574.43,-330.81 574.43,-274.02 512.33,-242.36 460.49,-225.83"/>
<polygon fill="#888888" stroke="#888888" points="461.52,-223.21 453.05,-223.55 459.88,-228.57 461.52,-223.21"/>
<text xml:space="preserve" text-anchor="middle" x="579.68" y="-586.75" font-family="Helvetica,Arial,sans-serif" font-size="9.00" fill="#888888">no</text>
</g>
<!-- chk_port -->
<g id="node5" class="node">
<title>chk_port</title>
<path fill="#fff3cd" stroke="#856404" d="M334.6,-754.35C334.6,-754.35 272.83,-724.9 272.83,-724.9 267.42,-722.32 267.42,-717.16 272.83,-714.57 272.83,-714.57 334.6,-685.12 334.6,-685.12 340.01,-682.54 350.85,-682.54 356.26,-685.12 356.26,-685.12 418.03,-714.57 418.03,-714.57 423.44,-717.16 423.44,-722.32 418.03,-724.9 418.03,-724.9 356.26,-754.35 356.26,-754.35 350.85,-756.94 340.01,-756.94 334.6,-754.35"/>
<text xml:space="preserve" text-anchor="middle" x="345.43" y="-721.49" font-family="Helvetica,Arial,sans-serif" font-size="10.00">src port 67</text>
<text xml:space="preserve" text-anchor="middle" x="345.43" y="-710.24" font-family="Helvetica,Arial,sans-serif" font-size="10.00">dst port 68?</text>
</g>
<!-- chk_ip&#45;&gt;chk_port -->
<g id="edge6" class="edge">
<title>chk_ip&#45;&gt;chk_port</title>
<path fill="none" stroke="#555555" d="M410.29,-817.88C398.34,-799.99 383.11,-777.18 370.41,-758.15"/>
<polygon fill="#555555" stroke="#555555" points="372.75,-756.61 365.98,-751.51 368.09,-759.72 372.75,-756.61"/>
<text xml:space="preserve" text-anchor="middle" x="397.6" y="-780.72" font-family="Helvetica,Arial,sans-serif" font-size="9.00">yes</text>
</g>
<!-- chk_ip&#45;&gt;discard -->
<g id="edge5" class="edge">
<title>chk_ip&#45;&gt;discard</title>
<path fill="none" stroke="#888888" d="M450.77,-818.11C465.72,-793.19 483.43,-756.17 483.43,-720.74 483.43,-720.74 483.43,-720.74 483.43,-330.81 483.43,-294.28 456.51,-261.89 431.79,-239.85"/>
<polygon fill="#888888" stroke="#888888" points="433.94,-238 426.05,-234.9 430.28,-242.24 433.94,-238"/>
<text xml:space="preserve" text-anchor="middle" x="488.68" y="-522.1" font-family="Helvetica,Arial,sans-serif" font-size="9.00" fill="#888888">no</text>
</g>
<!-- chk_op -->
<g id="node6" class="node">
<title>chk_op</title>
<path fill="#ffe0b2" stroke="#e65100" d="M240.24,-625.88C240.24,-625.88 159.69,-594.75 159.69,-594.75 154.1,-592.59 154.1,-588.27 159.69,-586.1 159.69,-586.1 240.24,-554.97 240.24,-554.97 245.83,-552.81 257.03,-552.81 262.62,-554.97 262.62,-554.97 343.17,-586.1 343.17,-586.1 348.76,-588.27 348.76,-592.59 343.17,-594.75 343.17,-594.75 262.62,-625.88 262.62,-625.88 257.03,-628.05 245.83,-628.05 240.24,-625.88"/>
<text xml:space="preserve" text-anchor="middle" x="251.43" y="-592.18" font-family="Helvetica,Arial,sans-serif" font-size="10.00">BOOTP op = 2</text>
<text xml:space="preserve" text-anchor="middle" x="251.43" y="-580.93" font-family="Helvetica,Arial,sans-serif" font-size="10.00">(BOOTREPLY)?</text>
</g>
<!-- chk_port&#45;&gt;chk_op -->
<g id="edge8" class="edge">
<title>chk_port&#45;&gt;chk_op</title>
<path fill="none" stroke="#555555" d="M324.1,-689.85C310.9,-671.97 293.81,-648.82 279.51,-629.47"/>
<polygon fill="#555555" stroke="#555555" points="281.89,-627.97 274.89,-623.2 277.38,-631.3 281.89,-627.97"/>
<text xml:space="preserve" text-anchor="middle" x="308.37" y="-651.41" font-family="Helvetica,Arial,sans-serif" font-size="9.00">yes</text>
</g>
<!-- chk_port&#45;&gt;discard -->
<g id="edge7" class="edge">
<title>chk_port&#45;&gt;discard</title>
<path fill="none" stroke="#888888" d="M368.9,-690.91C387.16,-666.36 409.43,-628.78 409.43,-591.43 409.43,-591.43 409.43,-591.43 409.43,-330.81 409.43,-302.14 404.42,-270.06 399.69,-246.15"/>
<polygon fill="#888888" stroke="#888888" points="402.48,-245.85 398.13,-238.57 396.99,-246.97 402.48,-245.85"/>
<text xml:space="preserve" text-anchor="middle" x="414.68" y="-457.44" font-family="Helvetica,Arial,sans-serif" font-size="9.00" fill="#888888">no</text>
</g>
<!-- chk_magic -->
<g id="node7" class="node">
<title>chk_magic</title>
<path fill="#ffe0b2" stroke="#e65100" d="M130.02,-497.17C130.02,-497.17 31.16,-464.85 31.16,-464.85 25.45,-462.98 25.45,-459.25 31.16,-457.39 31.16,-457.39 130.02,-425.07 130.02,-425.07 135.73,-423.2 147.13,-423.2 152.84,-425.07 152.84,-425.07 251.7,-457.39 251.7,-457.39 257.41,-459.25 257.41,-462.98 251.7,-464.85 251.7,-464.85 152.84,-497.17 152.84,-497.17 147.13,-499.03 135.73,-499.03 130.02,-497.17"/>
<text xml:space="preserve" text-anchor="middle" x="141.43" y="-462.87" font-family="Helvetica,Arial,sans-serif" font-size="10.00">DHCP magic cookie</text>
<text xml:space="preserve" text-anchor="middle" x="141.43" y="-451.62" font-family="Helvetica,Arial,sans-serif" font-size="10.00">0x63825363?</text>
</g>
<!-- chk_op&#45;&gt;chk_magic -->
<g id="edge10" class="edge">
<title>chk_op&#45;&gt;chk_magic</title>
<path fill="none" stroke="#555555" d="M226.19,-560.22C210.6,-542.18 190.44,-518.85 173.7,-499.46"/>
<polygon fill="#555555" stroke="#555555" points="176.04,-497.89 168.69,-493.66 171.8,-501.55 176.04,-497.89"/>
<text xml:space="preserve" text-anchor="middle" x="206.85" y="-522.1" font-family="Helvetica,Arial,sans-serif" font-size="9.00">yes</text>
</g>
<!-- chk_op&#45;&gt;discard -->
<g id="edge9" class="edge">
<title>chk_op&#45;&gt;discard</title>
<path fill="none" stroke="#888888" d="M264.1,-555.08C290.5,-483.51 351.18,-319.02 378.12,-245.97"/>
<polygon fill="#888888" stroke="#888888" points="380.72,-247.01 380.86,-238.54 375.47,-245.07 380.72,-247.01"/>
<text xml:space="preserve" text-anchor="middle" x="328.3" y="-392.79" font-family="Helvetica,Arial,sans-serif" font-size="9.00" fill="#888888">no</text>
</g>
<!-- chk_type -->
<g id="node8" class="node">
<title>chk_type</title>
<path fill="#ffe0b2" stroke="#e65100" d="M84.35,-366.97C84.35,-366.97 11.08,-336.43 11.08,-336.43 5.54,-334.12 5.54,-329.5 11.08,-327.19 11.08,-327.19 84.35,-296.65 84.35,-296.65 89.89,-294.34 100.97,-294.34 106.51,-296.65 106.51,-296.65 179.78,-327.19 179.78,-327.19 185.32,-329.5 185.32,-334.12 179.78,-336.43 179.78,-336.43 106.51,-366.97 106.51,-366.97 100.97,-369.28 89.89,-369.28 84.35,-366.97"/>
<text xml:space="preserve" text-anchor="middle" x="95.43" y="-333.56" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Option 53 = 5</text>
<text xml:space="preserve" text-anchor="middle" x="95.43" y="-322.31" font-family="Helvetica,Arial,sans-serif" font-size="10.00">(DHCP ACK)?</text>
</g>
<!-- chk_magic&#45;&gt;chk_type -->
<g id="edge12" class="edge">
<title>chk_magic&#45;&gt;chk_type</title>
<path fill="none" stroke="#555555" d="M128.74,-424.99C123.22,-409.72 116.7,-391.68 110.9,-375.62"/>
<polygon fill="#555555" stroke="#555555" points="113.63,-374.94 108.28,-368.36 108.36,-376.84 113.63,-374.94"/>
<text xml:space="preserve" text-anchor="middle" x="126.93" y="-392.79" font-family="Helvetica,Arial,sans-serif" font-size="9.00">yes</text>
</g>
<!-- chk_magic&#45;&gt;discard -->
<g id="edge11" class="edge">
<title>chk_magic&#45;&gt;discard</title>
<path fill="none" stroke="#888888" d="M165.47,-428.93C205.91,-376.67 284.66,-275.78 300.43,-262.28 312.13,-252.26 326.01,-243.15 339.37,-235.44"/>
<polygon fill="#888888" stroke="#888888" points="340.67,-237.92 346.27,-231.57 337.92,-233.04 340.67,-237.92"/>
<text xml:space="preserve" text-anchor="middle" x="278.97" y="-328.13" font-family="Helvetica,Arial,sans-serif" font-size="9.00" fill="#888888">no</text>
</g>
<!-- extract -->
<g id="node9" class="node">
<title>extract</title>
<path fill="#e3f2fd" stroke="#1565c0" d="M237.27,-242.28C237.27,-242.28 67.59,-242.28 67.59,-242.28 61.59,-242.28 55.59,-236.28 55.59,-230.28 55.59,-230.28 55.59,-187.5 55.59,-187.5 55.59,-181.5 61.59,-175.5 67.59,-175.5 67.59,-175.5 237.27,-175.5 237.27,-175.5 243.27,-175.5 249.27,-181.5 249.27,-187.5 249.27,-187.5 249.27,-230.28 249.27,-230.28 249.27,-236.28 243.27,-242.28 237.27,-242.28"/>
<text xml:space="preserve" text-anchor="middle" x="152.43" y="-224.14" font-family="Helvetica,Arial,sans-serif" font-size="10.00">Extract fields</text>
<text xml:space="preserve" text-anchor="middle" x="152.43" y="-212.89" font-family="Helvetica,Arial,sans-serif" font-size="10.00">yiaddr &#160;→ IP address</text>
<text xml:space="preserve" text-anchor="middle" x="152.43" y="-200.14" font-family="Helvetica,Arial,sans-serif" font-size="10.00">chaddr &#160;→ client MAC (6 bytes)</text>
<text xml:space="preserve" text-anchor="middle" x="152.43" y="-187.39" font-family="Helvetica,Arial,sans-serif" font-size="10.00">option 12 → hostname (or &#39;unknown&#39;)</text>
</g>
<!-- chk_type&#45;&gt;extract -->
<g id="edge14" class="edge">
<title>chk_type&#45;&gt;extract</title>
<path fill="none" stroke="#555555" d="M110.86,-298.09C117.7,-283.57 125.83,-266.33 133.07,-250.96"/>
<polygon fill="#555555" stroke="#555555" points="135.47,-252.44 136.35,-244.01 130.4,-250.05 135.47,-252.44"/>
<text xml:space="preserve" text-anchor="middle" x="134.47" y="-263.48" font-family="Helvetica,Arial,sans-serif" font-size="9.00">yes</text>
</g>
<!-- chk_type&#45;&gt;discard -->
<g id="edge13" class="edge">
<title>chk_type&#45;&gt;discard</title>
<path fill="none" stroke="#888888" d="M134.15,-307.71C159.19,-293.39 192.8,-275.32 223.93,-262.28 256.54,-248.62 294.01,-236.58 325.22,-227.5"/>
<polygon fill="#888888" stroke="#888888" points="325.91,-230.22 332.82,-225.31 324.36,-224.83 325.91,-230.22"/>
<text xml:space="preserve" text-anchor="middle" x="229.18" y="-263.48" font-family="Helvetica,Arial,sans-serif" font-size="9.00" fill="#888888">no</text>
</g>
<!-- spawn -->
<g id="node10" class="node">
<title>spawn</title>
<path fill="#d4edda" stroke="#28a745" d="M291.52,-134.5C291.52,-134.5 141.34,-134.5 141.34,-134.5 135.34,-134.5 129.34,-128.5 129.34,-122.5 129.34,-122.5 129.34,-95.47 129.34,-95.47 129.34,-89.47 135.34,-83.47 141.34,-83.47 141.34,-83.47 291.52,-83.47 291.52,-83.47 297.52,-83.47 303.52,-89.47 303.52,-95.47 303.52,-95.47 303.52,-122.5 303.52,-122.5 303.52,-128.5 297.52,-134.5 291.52,-134.5"/>
<text xml:space="preserve" text-anchor="middle" x="216.43" y="-116.36" font-family="Helvetica,Arial,sans-serif" font-size="10.00">subprocess.Popen()</text>
<text xml:space="preserve" text-anchor="middle" x="216.43" y="-105.11" font-family="Helvetica,Arial,sans-serif" font-size="10.00">/opt/bm&#45;dhcp&#45;tap/dhcp_hook2.sh</text>
<text xml:space="preserve" text-anchor="middle" x="216.43" y="-93.86" font-family="Helvetica,Arial,sans-serif" font-size="10.00">IP &#160;MAC &#160;HOSTNAME</text>
</g>
<!-- extract&#45;&gt;spawn -->
<g id="edge15" class="edge">
<title>extract&#45;&gt;spawn</title>
<path fill="none" stroke="#555555" d="M173.92,-175.02C180.75,-164.57 188.3,-153.02 195.11,-142.59"/>
<polygon fill="#555555" stroke="#555555" points="197.3,-144.37 199.33,-136.14 192.61,-141.3 197.3,-144.37"/>
</g>
<!-- loop -->
<g id="node12" class="node">
<title>loop</title>
<ellipse fill="#f0f4f8" stroke="#446688" cx="391.43" cy="-21.23" rx="64.3" ry="21.23"/>
<text xml:space="preserve" text-anchor="middle" x="391.43" y="-18.11" font-family="Helvetica,Arial,sans-serif" font-size="10.00">← next frame</text>
</g>
<!-- spawn&#45;&gt;loop -->
<g id="edge16" class="edge">
<title>spawn&#45;&gt;loop</title>
<path fill="none" stroke="#555555" d="M267.05,-83.18C292.69,-70.62 323.51,-55.51 348.06,-43.49"/>
<polygon fill="#555555" stroke="#555555" points="349.15,-46.07 355.1,-40.04 346.68,-41.04 349.15,-46.07"/>
</g>
<!-- discard&#45;&gt;loop -->
<g id="edge17" class="edge">
<title>discard&#45;&gt;loop</title>
<path fill="none" stroke="#555555" d="M391.43,-180.49C391.43,-146.2 391.43,-87.65 391.43,-52.2"/>
<polygon fill="#555555" stroke="#555555" points="394.23,-52.36 391.43,-44.36 388.63,-52.36 394.23,-52.36"/>
</g>
<!-- loop&#45;&gt;recv -->
<g id="edge18" class="edge">
<title>loop&#45;&gt;recv</title>
<path fill="none" stroke="#555555" d="M450.71,-29.95C526.61,-41.51 648.43,-66.53 648.43,-107.98 648.43,-979.36 648.43,-979.36 648.43,-979.36 648.43,-1010.14 624.32,-1035.85 601.48,-1053.31"/>
<polygon fill="#555555" stroke="#555555" points="599.85,-1051.03 595.05,-1058.01 603.16,-1055.55 599.85,-1051.03"/>
</g>
</g>
</svg>
